# GoBuster Modes Deep Dive: dir, dns, vhost

## Table of Contents
- [Directory Brute-Forcing (dir)](#directory-brute-forcing-dir)
- [DNS Subdomain Enumeration (dns)](#dns-subdomain-enumeration-dns)
- [Virtual Host Discovery (vhost)](#virtual-host-discovery-vhost)
- [Real-World Attack Scenarios](#real-world-attack-scenarios)

## Directory Brute-Forcing (dir)

### Theory and Concept

**What is Directory Brute-Forcing?**
Directory brute-forcing is the process of systematically checking for hidden files and directories on a web server by testing a large list of possible paths. This technique reveals resources that aren't linked from the main website but are still accessible.

**How Web Servers Handle Paths:**
```
http://example.com/admin/    → Directory (returns 200/301/403)
http://example.com/admin.php → File (returns 200)
http://example.com/backup.zip → File (returns 200)
```

**HTTP Status Codes Explained:**
- `200 OK` - Resource exists and is accessible
- `301/302 Redirect` - Resource exists but redirects elsewhere
- `403 Forbidden` - Resource exists but access is denied
- `404 Not Found` - Resource does not exist
- `401 Unauthorized` - Resource requires authentication

### Key Options Deep Dive

```bash
# Basic structure
gobuster dir -u http://target.com -w wordlist.txt [options]
```

**Critical Options Explained:**

1. **`-x` (Extensions):** Tests files with specific extensions
   ```bash
   # Why this matters: Many sites have admin.php, not just /admin
   gobuster dir -u http://site.com -w wordlist.txt -x php,html,txt,js
   ```

2. **`-s` (Status Codes):** Customize what constitutes a "find"
   ```bash
   # Why: Some sites return unusual codes for valid resources
   gobuster dir -u http://site.com -w wordlist.txt -s 200,301,302,403,500
   ```

3. **`-b` (Blacklist):** Ignore specific status codes
   ```bash
   # Why: If site returns 200 for non-existent pages with custom 404
   gobuster dir -u http://site.com -w wordlist.txt -b 404,400
   ```

4. **`-f` (Append Slash):** Crucial for directory discovery
   ```bash
   # Why: /admin vs /admin/ behave differently on web servers
   gobuster dir -u http://site.com -w wordlist.txt -f
   ```

### Real-World Scenario: The Hidden Admin Panel

**Target:** A corporate website at `http://company.com`

**Attack Steps:**

1. **Initial Reconnaissance:**
   ```bash
   # First, understand the site structure
   curl -I http://company.com
   # Check if it has a custom 404 page
   curl http://company.com/randomnonexistentpage
   ```

2. **Comprehensive Directory Scan:**
   ```bash
   gobuster dir -u http://company.com \
     -w /usr/share/wordlists/dirb/common.txt \
     -x php,html,txt,conf,backup,bak \
     -s 200,301,302,403,401 \
     -f \
     -t 50 \
     -o initial_scan.txt
   ```

3. **Analyze Results:**
   ```bash
   # Look for interesting finds
   grep -E "(admin|login|dashboard|config|backup)" initial_scan.txt
   ```

4. **Discoveries:**
   ```
   http://company.com/admin/        (301 → /admin/) - Directory redirect
   http://company.com/backup.zip    (200) - Sensitive file
   http://company.com/config.php    (200) - Configuration file
   http://company.com/phpinfo.php   (200) - Information disclosure
   ```

## DNS Subdomain Enumeration (dns)

### Theory and Concept

**What is DNS Subdomain Enumeration?**
DNS subdomain enumeration is the process of discovering subdomains associated with a domain by querying DNS servers. This reveals hidden services, development environments, and potential attack surfaces.

**DNS Hierarchy:**
```
root → .com → example.com → subdomain.example.com
```

**Why Subdomains Matter:**
- `admin.example.com` - Administrative interface
- `dev.example.com` - Development environment (often less secure)
- `api.example.com` - API endpoints
- `mail.example.com` - Email services
- `vpn.example.com` - VPN access point

### Key Options Deep Dive

```bash
# Basic structure
gobuster dns -d example.com -w wordlist.txt [options]
```

**Critical Options Explained:**

1. **`-r` (Resolver):** Specify custom DNS server
   ```bash
   # Why: Some DNS servers might have different records or bypass caching
   gobuster dns -d example.com -w wordlist.txt -r 8.8.8.8
   ```

2. **`-i` (Show IP):** Display IP addresses of found subdomains
   ```bash
   # Why: Helps identify if multiple subdomains point to same server
   gobuster dns -d example.com -w wordlist.txt -i
   ```

3. **`-c` (Show Wildcard):** Display wildcard results
   ```bash
   # Why: Helps identify wildcard DNS configurations
   gobuster dns -d example.com -w wordlist.txt -c
   ```

### Wildcard DNS Handling

**What are Wildcard DNS Records?**
A wildcard DNS record (`*.example.com`) points all non-existent subdomains to a specific IP address. This can make subdomain enumeration challenging.

**Detecting Wildcards:**
```bash
# First, test for wildcard DNS
dig random12345.example.com
nslookup nonexistent123.example.com

# If these resolve, wildcard DNS is likely present
```

**Gobuster's Wildcard Handling:**
```bash
# Gobuster automatically handles wildcards by:
# 1. First checking a random subdomain to detect wildcards
# 2. Filtering out results that match the wildcard response
gobuster dns -d example.com -w wordlist.txt -i
```

### Real-World Scenario: Expanding Attack Surface

**Target:** `example.com` - A large e-commerce platform

**Attack Steps:**

1. **Wildcard Detection:**
   ```bash
   dig random12345.example.com
   # Returns: 192.168.1.100 → Wildcard detected
   ```

2. **Subdomain Enumeration:**
   ```bash
   gobuster dns -d example.com \
     -w /usr/share/wordlists/SecLists/Discovery/DNS/subdomains-top1million-20000.txt \
     -r 1.1.1.1 \
     -i \
     -t 100 \
     -o subdomains.txt
   ```

3. **Analyze Results:**
   ```bash
   # Look for interesting subdomains
   grep -E "(admin|dev|staging|api|vpn|mail)" subdomains.txt
   ```

4. **Discoveries:**
   ```
   admin.example.com → 10.10.10.50 (Different IP!)
   dev.example.com → 192.168.1.101 
   api.example.com → 192.168.1.102
   vpn.example.com → 203.0.113.5
   ```

5. **Follow-up Actions:**
   - Scan each discovered IP separately
   - Check for vulnerabilities on development subdomain
   - Test API endpoints for security issues

## Virtual Host Discovery (vhost)

### Theory and Concept

**What are Virtual Hosts?**
Virtual Hosts allow multiple websites to be hosted on the same server and IP address. The web server determines which website to serve based on the `Host` HTTP header.

**Traditional vs Virtual Host Setup:**
```
Traditional: One IP = One Website
192.168.1.100 → example.com

Virtual Hosts: One IP = Multiple Websites
192.168.1.100 + Host: example.com → example.com website
192.168.1.100 + Host: admin.example.com → admin website
192.168.1.100 + Host: internal.example.com → internal portal
```

**Why Virtual Host Discovery Matters:**
- Reveals hidden administrative interfaces
- Exposes development/staging environments
- Uncovers internal applications not meant for public access

### Key Options Deep Dive

```bash
# Basic structure
gobuster vhost -u http://target.com -w wordlist.txt [options]
```

**Critical Options Explained:**

1. **`--domain` (Base Domain):** Specifies the base domain for comparison
   ```bash
   # Why: Helps Gobuster distinguish between valid and invalid vhosts
   gobuster vhost -u http://192.168.1.100 -w wordlist.txt --domain example.com
   ```

2. **`--append-domain` (Append to Base):** Appends the base domain to words
   ```bash
   # Why: Tests admin.example.com instead of just admin
   gobuster vhost -u http://192.168.1.100 -w wordlist.txt --append-domain
   ```

### The `--domain` vs `--append-domain` Mystery

**Understanding the Difference:**

**Scenario 1: Using `--domain` only**
```bash
gobuster vhost -u http://192.168.1.100 -w wordlist.txt --domain example.com
```
- Tests: `admin` (as Host: admin)
- Compares responses against `example.com` baseline
- Good for finding completely different vhost names

**Scenario 2: Using `--append-domain`**
```bash
gobuster vhost -u http://192.168.1.100 -w wordlist.txt --append-domain
```
- Tests: `admin.example.com` (as Host: admin.example.com)
- Appends the target's domain to each word
- Good for finding subdomain-based vhosts

**Scenario 3: Using both**
```bash
gobuster vhost -u http://192.168.1.100 -w wordlist.txt --domain example.com --append-domain
```
- Tests both approaches
- Most comprehensive coverage

### How VHost Detection Works Technically

1. **Baseline Establishment:**
   ```bash
   # Gobuster first visits the target with original Host header
   GET / HTTP/1.1
   Host: example.com
   ```

2. **Test Each Word:**
   ```bash
   # Then tests each word from the wordlist
   GET / HTTP/1.1
   Host: admin.example.com
   ```

3. **Response Comparison:**
   - Compares size, status code, and content
   - Flags differences from baseline as potential vhosts

### Real-World Scenario: The Hidden Internal Portal

**Target:** A company's main web server at `http://203.0.113.10`

**Initial Assessment:**
```bash
# Normal access
curl http://203.0.113.10
# Returns: Company's public website
```

**Attack Steps:**

1. **Baseline VHost Scan:**
   ```bash
   gobuster vhost -u http://203.0.113.10 \
     -w /usr/share/wordlists/SecLists/Discovery/DNS/subdomains-top1million-5000.txt \
     --domain company.com \
     --append-domain \
     -t 30 \
     -o vhost_scan.txt
   ```

2. **Manual Verification:**
   ```bash
   # Test interesting finds manually
   curl -H "Host: internal.company.com" http://203.0.113.10
   curl -H "Host: admin.company.com" http://203.0.113.10
   ```

3. **Discoveries:**
   ```
   VHost found: internal.company.com ✅
   - Different page size and content
   - Shows internal employee portal
   
   VHost found: dev.company.com ✅  
   - Development environment with debug info
   - Less security controls
   
   VHost found: admin.company.com ✅
   - Administrative login panel
   - Not accessible via public DNS
   ```

4. **Exploitation Path:**
   - Add vhost entries to local hosts file:
     ```
     203.0.113.10 internal.company.com
     203.0.113.10 admin.company.com
     ```
   - Access these interfaces directly
   - Look for vulnerabilities in less-secure dev environment

## Real-World Attack Scenarios

### Scenario 1: Comprehensive Web App Assessment

**Target:** `https://target-company.com`

**Phase 1: Subdomain Discovery**
```bash
gobuster dns -d target-company.com \
  -w subdomains.txt \
  -r 8.8.8.8 \
  -i \
  -o subdomains_found.txt
```

**Phase 2: VHost Discovery on Interesting IPs**
```bash
# For each unique IP found
gobuster vhost -u http://192.168.1.50 \
  -w vhost_wordlist.txt \
  --domain target-company.com \
  --append-domain
```

**Phase 3: Directory Brute-Force on Discovered Services**
```bash
# For each interesting subdomain/vhost
gobuster dir -u https://admin.target-company.com \
  -w directory_list.txt \
  -x php,asp,aspx \
  -t 40
```

### Scenario 2: Internal Network Penetration Test

**Situation:** You have access to an internal network segment

**Step 1: Discover Web Services**
```bash
nmap -p 80,443,8080,8443 192.168.1.0/24
```

**Step 2: VHost Discovery on Each Web Server**
```bash
gobuster vhost -u http://192.168.1.100 \
  -w internal_subdomains.txt \
  --append-domain \
  --domain internal.company.com
```

**Step 3: Directory Enumeration**
```bash
gobuster dir -u http://192.168.1.100 \
  -w common_dirs.txt \
  -f \
  -x txt,log,conf,bak
```

### Why These Three Modes Work Together

1. **DNS Mode** finds subdomains → expands attack surface
2. **VHost Mode** finds hidden sites on known IPs → reveals unlinked content  
3. **Dir Mode** finds hidden paths on discovered sites → exposes vulnerabilities

**The Complete Reconnaissance Chain:**
```
DNS Enumeration → Find subdomains → Get IPs → 
VHost Discovery → Find hidden sites → 
Directory Brute-Force → Find hidden pages → 
Manual Testing → Exploitation
```

